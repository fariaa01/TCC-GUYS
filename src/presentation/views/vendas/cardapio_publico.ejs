<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= empresaNome %> — Cardápio</title>
  <link rel="stylesheet" href="/cardapio/cardapio.css" />
</head>

<body>
<<<<<<< Updated upstream
=======
  <div class="layout-cardapio">
    <main class="col-catalogo">
      <div class="container">
        <header class="topbar">
          <h1><%= empresaNome %></h1>
          <div style="display:flex; gap:10px; align-items:center;">
            <a href="/lojas" class="btn-ghost">Trocar loja</a>
          </div>
        </header>
>>>>>>> Stashed changes

<div class="layout-cardapio">
  <main class="col-catalogo">
    <div class="container">

      <!-- TOPO -->
      <header class="topbar">
        <div class="topbar-left">
          <h1 class="brand"><%= empresaNome %></h1>
          <span class="brand-sub">Cardápio</span>
        </div>

        <div class="topbar-center">
          <label class="search">
            <input id="searchMenu" type="search" placeholder="Buscar pratos, categorias..." aria-label="Buscar no cardápio">
            <button type="button" class="search-clear" aria-label="Limpar busca">✕</button>
          </label>
        </div>

        <div class="topbar-right">
          <a href="/restaurantes" class="btn-ghost">Trocar restaurante</a>
        </div>
      </header>

      <!-- LISTA DE ITENS -->
      <% if (!itens || !itens.length) { %>
        <p class="vazio">Este restaurante ainda não tem itens no cardápio.</p>
      <% } else { %>
        <div class="grid-cards">
          <% itens.forEach(function(i){ %>
            <div class="card" data-cat="<%= i.categoria || 'Outros' %>">

              <% if (i.desconto) { %>
                <span class="badge"><%= i.desconto %>%</span>
              <% } %>

              <% if (i.avaliacao !== undefined && i.avaliacao !== null) { %>
                <span class="price-badge"><%= Number(i.avaliacao).toFixed(1) %> ★</span>
              <% } %>

              <% if (i.imagem) { %>
                <img src="/uploads/<%= i.imagem %>" alt="<%= i.nome_prato %>">
              <% } else { %>
                <div class="img-placeholder" aria-label="Sem imagem"></div>
              <% } %>

              <div class="card-body">
                <h3 class="titulo"><%= i.nome_prato %></h3>

                <% if (i.descricao) { %>
                  <p class="desc"><%= i.descricao %></p>
                <% } else { %>
                  <p class="desc muted">Sem descrição.</p>
                <% } %>

                <div class="card-footer">
                  <strong class="preco">R$ <%= Number(i.preco).toFixed(2).replace('.', ',') %></strong>

<<<<<<< Updated upstream
                  <button 
                    type="button"
                    class="btn ver-item"
                    data-id="<%= i.id %>"
                    aria-label="Ver detalhes de <%= i.nome_prato %>">
                      Detalhes
                  </button>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>

    </div>
  </main>
</div>

<!-- CARRINHO LATERAL -->
<div id="sideCart" class="side-cart">
  <div class="side-cart-header">
    <h2>Carrinho</h2>
    <button id="closeCart" class="close-cart">✕</button>
  </div>

  <div id="cartItems" class="side-cart-items"></div>

  <div class="side-cart-footer">
    <div class="total">
      Total: <span id="cartTotal">R$ 0,00</span>
    </div>
    <a href="/checkout" class="btn-checkout">Finalizar Pedido</a>
  </div>
</div>

<!-- OVERLAY -->
<div id="cartOverlay" class="cart-overlay"></div>

<!-- SCRIPTS (APENAS UMA VEZ E NO FINAL DO BODY!) -->
<script nonce="<%= cspNonce %>" src="/cardapio/cardapio.js"></script>
=======
                  <% if (i.descricao) { %>
                    <p class="desc"><%= i.descricao %></p>
                  <% } else { %>
                    <p class="desc muted">Sem descrição.</p>
                  <% } %>

                  <div class="card-footer">
                    <% if (i.tamanhos && Array.isArray(i.tamanhos) && i.tamanhos.length > 0) { %>
                      <div class="precos-multiplos">
                        <strong class="preco-range">
                          <% 
                            const precos = i.tamanhos.map(t => Number(t.preco || 0)).filter(p => p > 0);
                            const menorPreco = precos.length > 0 ? Math.min(...precos) : Number(i.preco || 0);
                          %>
                          A partir de R$ <%= menorPreco.toFixed(2).replace('.', ',') %>
                        </strong>
                        <small class="tamanhos-info"><%= i.tamanhos.length %> tamanhos disponíveis</small>
                      </div>
                      <button type="button" class="btn btn-info" aria-label="Consultar <%= i.nome_prato %>">Consultar</button>
                    <% } else { %>
                      <strong class="preco">R$ <%= Number(i.preco || 0).toFixed(2).replace('.', ',') %></strong>
                      <button type="button" class="btn btn-info" aria-label="Consultar <%= i.nome_prato %>">Consultar</button>
                    <% } %>
                  </div>
                </div>
              </div>
            <% }) %>
          </div>
        <% } %>
      </div>
    </main>

    <!-- Carrinho removido nesta versão pública -->
  </div>

  <div id="authModal" class="auth-modal" aria-hidden="true">
    <div class="auth-backdrop" data-close-auth></div>
    <div class="auth-dialog" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <header class="auth-header">
        <h3 id="authTitle">Identifique-se</h3>
        <button class="auth-close" type="button" aria-label="Fechar" data-close-auth>✕</button>
      </header>

      <nav class="auth-tabs" role="tablist" aria-label="Acesso do cliente">
        <button class="auth-tab is-active" role="tab" aria-selected="true" aria-controls="pane-login" id="tab-login">Entrar</button>
        <button class="auth-tab" role="tab" aria-selected="false" aria-controls="pane-cadastro" id="tab-cadastro">Cadastrar</button>
      </nav>

      <section id="pane-login" class="auth-pane is-active" role="tabpanel" aria-labelledby="tab-login">
        <form id="formLogin" class="auth-form" autocomplete="on" data-endpoint-login="/cliente/login">
          <input type="hidden" name="next" value="/checkout" />
          <label class="auth-field">
            <span>Email</span>
            <input type="email" name="email" required placeholder="voce@email.com" />
          </label>
          <label class="auth-field">
            <span>Senha</span>
            <input type="password" name="senha" required placeholder="Sua senha" minlength="4" />
          </label>
          <button class="auth-submit" type="submit">Entrar</button>
          <p class="auth-feedback" id="loginFeedback" aria-live="polite"></p>
        </form>
      </section>

      <section id="pane-cadastro" class="auth-pane" role="tabpanel" aria-labelledby="tab-cadastro" hidden>
        <form id="formCadastro" class="auth-form" autocomplete="on" data-endpoint-cadastro="/cliente/cadastrar">
          <input type="hidden" name="next" value="/checkout" />
          <label class="auth-field">
            <span>Nome</span>
            <input type="text" name="nome" required placeholder="Seu nome" />
          </label>
          <label class="auth-field">
            <span>Email</span>
            <input type="email" name="email" required placeholder="voce@email.com" />
          </label>
          <label class="auth-field">
            <span>Senha</span>
            <input type="password" name="senha" required placeholder="Crie uma senha" minlength="4" />
          </label>
          <button class="auth-submit" type="submit">Criar conta</button>
          <p class="auth-feedback" id="cadastroFeedback" aria-live="polite"></p>
        </form>
      </section>
    </div>
  </div>

  <div id="modalTamanhos" class="modal-overlay" aria-hidden="true">
    <div class="modal-content modal-tamanhos" role="dialog" aria-labelledby="modal-tamanhos-title">
      <header class="modal-header">
        <h3 id="modal-tamanhos-title">Escolha o tamanho</h3>
        <button type="button" class="modal-close" aria-label="Fechar modal">&times;</button>
      </header>
      
      <div class="modal-body">
        <div class="produto-info">
          <img id="modal-produto-img" src="" alt="" class="produto-thumb">
          <div class="produto-detalhes">
            <h4 id="modal-produto-nome"></h4>
            <p class="produto-descricao">Escolha o tamanho desejado:</p>
          </div>
        </div>
        
        <div class="tamanhos-lista" id="tamanhosList">
        </div>
        
        <div class="quantidade-controls">
          <label for="modalQuantidade">Quantidade:</label>
          <div class="qty-input">
            <button type="button" class="qty-btn" data-action="decrease">-</button>
            <input type="number" id="modalQuantidade" value="1" min="1" max="99">
            <button type="button" class="qty-btn" data-action="increase">+</button>
          </div>
        </div>
      </div>
      
      <footer class="modal-footer">
        <button type="button" class="btn btn-secondary modal-cancelar">Cancelar</button>
        <button type="button" class="btn btn-primary modal-adicionar" disabled>
          <span class="btn-text">Adicionar ao Carrinho</span>
          <span class="btn-preco">R$ 0,00</span>
        </button>
      </footer>
    </div>
  </div>
  <!-- ========== /MODAL SELEÇÃO DE TAMANHOS ========== -->
>>>>>>> Stashed changes

</body>
<<<<<<< Updated upstream
</html>

=======
</html>
>>>>>>> Stashed changes
