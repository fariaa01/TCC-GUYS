<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title><%= empresaNome %> — Cardápio</title>
  <link rel="stylesheet" href="/cardapio/cardapio.css" />
</head>

<body>

<div class="layout-cardapio">
  <main class="col-catalogo">
    <div class="container">

      <!-- TOPO -->
      <header class="topbar">
        <div class="topbar-left">
          <h1 class="brand"><%= empresaNome %></h1>
          <span class="brand-sub">Cardápio</span>
        </div>

        <div class="topbar-center">
          <label class="search">
            <input id="searchMenu" type="search" placeholder="Buscar pratos, categorias..." aria-label="Buscar no cardápio">
            <button type="button" class="search-clear" aria-label="Limpar busca">✕</button>
          </label>
        </div>

        <div class="topbar-right">
          <a href="/restaurantes" class="btn-ghost">Trocar restaurante</a>
        </div>
      </header>

      <!-- LISTA DE ITENS -->
      <% if (!itens || !itens.length) { %>
        <p class="vazio">Este restaurante ainda não tem itens no cardápio.</p>
      <% } else { %>
        <div class="grid-cards">
          <% itens.forEach(function(i){ %>
            <div class="card" data-cat="<%= i.categoria || 'Outros' %>">

              <% if (i.desconto) { %>
                <span class="badge"><%= i.desconto %>%</span>
              <% } %>

              <% if (i.avaliacao !== undefined && i.avaliacao !== null) { %>
                <span class="price-badge"><%= Number(i.avaliacao).toFixed(1) %> ★</span>
              <% } %>

              <% if (i.imagem) { %>
                <img src="/uploads/<%= i.imagem %>" alt="<%= i.nome_prato %>">
              <% } else { %>
                <div class="img-placeholder" aria-label="Sem imagem"></div>
              <% } %>

              <div class="card-body">
                <h3 class="titulo"><%= i.nome_prato %></h3>

                <% if (i.descricao) { %>
                  <p class="desc"><%= i.descricao %></p>
                <% } else { %>
                  <p class="desc muted">Sem descrição.</p>
                <% } %>

                <div class="card-footer">
                  <strong class="preco">R$ <%= Number(i.preco).toFixed(2).replace('.', ',') %></strong>

                  <button 
                    type="button"
                    class="btn ver-item"
                    data-id="<%= i.id %>"
                    aria-label="Ver detalhes de <%= i.nome_prato %>">
                      Detalhes
                  </button>
                </div>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>

    </div>
  </main>
</div>

<!-- CARRINHO LATERAL -->
<div id="sideCart" class="side-cart">
  <div class="side-cart-header">
    <h2>Carrinho</h2>
    <button id="closeCart" class="close-cart">✕</button>
  </div>

  <div id="cartItems" class="side-cart-items"></div>

  <div class="side-cart-footer">
    <div class="total">
      Total: <span id="cartTotal">R$ 0,00</span>
    </div>
    <a href="/checkout" class="btn-checkout">Finalizar Pedido</a>
  </div>
</div>

<!-- OVERLAY -->
<div id="cartOverlay" class="cart-overlay"></div>

<!-- SCRIPTS (APENAS UMA VEZ E NO FINAL DO BODY!) -->
<script nonce="<%= cspNonce %>" src="/cardapio/cardapio.js"></script>

</body>
</html>

